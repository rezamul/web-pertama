<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalkulator Online</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#06b6d4; --muted:#94a3b8; --glass: rgba(255,255,255,0.04);
      --btn:#0b1220; --btn-hover:#111827; --danger:#ef4444;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,#071126 0%, #081226 60%); color:#e6eef8;
      padding:24px;
    }
    .card{
      width:360px; max-width:100%; background:linear-gradient(180deg,var(--card),#061226); border-radius:14px; padding:18px; box-shadow:0 10px 30px rgba(2,6,23,0.6);
    }
    .header{display:flex; align-items:center; justify-content:space-between}
    .title{font-weight:600; letter-spacing:0.2px}
    .subtitle{font-size:12px; color:var(--muted)}

    .screen{margin-top:14px; background:var(--glass); border-radius:10px; padding:12px; min-height:76px; display:flex; flex-direction:column; justify-content:center}
    .expr{font-size:14px; color:var(--muted); text-align:right; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .result{font-size:28px; font-weight:700; text-align:right; margin-top:4px}

    .pad{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-top:14px}
    button{background:var(--btn); border:1px solid rgba(255,255,255,0.03); padding:14px; border-radius:10px; font-size:18px; color:inherit; cursor:pointer}
    button:hover{background:var(--btn-hover)}
    .op{background:linear-gradient(180deg,#062737,#083344); color:var(--accent); font-weight:600}
    .wide{grid-column:span 2}
    .danger{background:linear-gradient(180deg,#3b0f0f,#2a0b0b); color:var(--danger)}
    .muted{background:transparent; color:var(--muted); border:1px dashed rgba(255,255,255,0.03)}

    .footer{font-size:12px; color:var(--muted); margin-top:12px; text-align:center}

    @media (max-width:420px){ .card{padding:12px} button{padding:12px; font-size:16px} .result{font-size:24px} }
  </style>
</head>
<body>
  <div class="card" role="application" aria-label="Kalkulator online">
    <div class="header">
      <div>
        <div class="title">Kalkulator Online</div>
        <div class="subtitle">Sederhana — Mendukung keyboard</div>
      </div>
      <div style="font-size:12px;color:var(--muted)">v1.0</div>
    </div>

    <div class="screen" id="screen">
      <div class="expr" id="expr">0</div>
      <div class="result" id="result">0</div>
    </div>

    <div class="pad" id="pad">
      <button class="muted" data-action="clear">C</button>
      <button class="muted" data-action="back">⌫</button>
      <button class="muted" data-value="%">%</button>
      <button class="op" data-value="/">÷</button>

      <button data-value="7">7</button>
      <button data-value="8">8</button>
      <button data-value="9">9</button>
      <button class="op" data-value="*">×</button>

      <button data-value="4">4</button>
      <button data-value="5">5</button>
      <button data-value="6">6</button>
      <button class="op" data-value="-">−</button>

      <button data-value="1">1</button>
      <button data-value="2">2</button>
      <button data-value="3">3</button>
      <button class="op" data-value="+">+</button>

      <button data-value="0" class="wide">0</button>
      <button data-value=".">.</button>
      <button class="op" data-action="equals">=</button>
    </div>

    <div class="footer">Tekan Enter untuk =, Del untuk Hapus, Esc untuk Clear</div>
  </div>

  <script>
    (function(){
      const exprEl = document.getElementById('expr');
      const resultEl = document.getElementById('result');
      const pad = document.getElementById('pad');

      let expr = '';
      const safeChars = /[0-9+\-*/().% ]/;

      function setExpr(v){
        expr = v.replace(/^\s+|\s+$/g,'');
        if(expr === '') expr = '0';
        exprEl.textContent = expr;
      }

      function compute(){
        try{
          if(!expr || expr.trim()==='') { resultEl.textContent = '0'; return }
          // sanitize: only allow digits, operators, parentheses, dot and percent and spaces
          if(!/^[-+*/().% 0-9]+$/.test(expr)) { resultEl.textContent = 'Error'; return }
          // replace percent: 50% -> (50/100)
          const transformed = expr.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
          // eslint-disable-next-line no-new-func
          const fn = new Function('return ' + transformed);
          let val = fn();
          if(typeof val === 'number' && !Number.isFinite(val)) throw new Error('not finite');
          if(Number.isNaN(val)) throw new Error('nan');
          // format result: trim long decimals
          if(Number.isFinite(val) && Math.abs(val) < 1e12){
            val = Math.round((val + Number.EPSILON) * 1e10) / 1e10;
          }
          resultEl.textContent = String(val);
        }catch(e){
          resultEl.textContent = 'Error';
        }
      }

      pad.addEventListener('click', (ev)=>{
        const btn = ev.target.closest('button');
        if(!btn) return;
        const val = btn.getAttribute('data-value');
        const act = btn.getAttribute('data-action');

        if(act === 'clear'){
          setExpr(''); compute(); return;
        }
        if(act === 'back'){
          setExpr(expr === '0' ? '' : expr.slice(0, -1)); compute(); return;
        }
        if(act === 'equals'){
          compute(); setExpr(resultEl.textContent); return;
        }

        // append value
        if(val){
          if(expr==='0' && /[0-9]/.test(val)) setExpr(val);
          else setExpr((expr==='0'? '': expr) + val);
          compute();
        }
      });

      // keyboard support
      window.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter') { e.preventDefault(); compute(); setExpr(resultEl.textContent); return }
        if(e.key === 'Escape') { setExpr(''); compute(); return }
        if(e.key === 'Backspace') { e.preventDefault(); setExpr(expr === '0' ? '' : expr.slice(0,-1)); compute(); return }
        const key = e.key;
        // allow digits and operators
        if(/^[0-9+\-*/().%]$/.test(key)){
          setExpr((expr==='0'? '': expr) + key);
          compute();
        }
        if(key === '%') { setExpr((expr==='0'? '': expr) + '%'); compute(); }
        if(key === '.') { setExpr((expr==='0'? '': expr) + '.'); compute(); }
      });

      // initialize
      setExpr('0'); compute();

    })();
  </script>
</body>
</html>
